{% load static %} 
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Social Project{% endblock %}</title>
    <link rel="stylesheet" href="{% static 'core/style.css' %}">
</head>
<body>
    <header>
      <nav>
        <ul>
            
            {% if user.is_authenticated %}
            <li><a href="{% url 'home' %}">Home</a></li>
            <li><a href="{% url 'profile' user.id %}">My Profile</a></li>
            <form method="post" action="{% url 'logout' %}" style="display: inline;">
              {% csrf_token %}
              <button type="submit">Logout</button>
          </form>
            {% else %}
            <li><a href="{% url 'login' %}">Login</a></li>
            <li><a href="{% url 'signup' %}">Signup</a></li>
            {% endif %}
        </ul>
    </nav>
    </header>

    <!-- Messages Section -->
    {% if messages %}
    <ul class="messages">
        {% for message in messages %}
        <li class="{{ message.tags }}">{{ message }}</li>
        {% endfor %}
    </ul>
    {% endif %}

    <main>
        {% block content %}
        {% endblock %}
    </main>

    <footer>
        <p>&copy; 2025 Social Project. All rights reserved.</p>
    </footer>
    <script>
      document.addEventListener('DOMContentLoaded', function () {
          document.querySelectorAll('.like-button').forEach(function (button) {
              button.addEventListener('click', function (event) {
                  event.preventDefault(); // Prevent the form submission
      
                  const postId = button.dataset.postId;
                  const likeUrl = button.dataset.likeUrl;
      
                  fetch(likeUrl, {
                      method: 'POST',
                      headers: {
                          'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                      },
                  })
                  .then(response => response.json())
                  .then(data => {
                      if (data.liked) {
                          button.textContent = 'Unlike';
                      } else {
                          button.textContent = 'Like';
                      }
                      const likeCount = document.querySelector(`#like-count-${postId}`);
                      likeCount.textContent = `${data.like_count} likes`;
                  })
                  .catch(error => console.error('Error:', error));
              });
          });
      });
      document.querySelectorAll('.comment-form').forEach(function (form) {
        form.addEventListener('submit', function (event) {
            event.preventDefault(); // Prevent the default form submission
    
            const postId = form.dataset.postId;
            const url = "{% url 'add_comment' 0 %}".replace('0', postId);
            const csrfToken = form.querySelector('[name=csrfmiddlewaretoken]').value;
            const commentContent = form.querySelector('textarea[name="content"]').value;
    
            fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded', // Use form-encoded content
                    'X-CSRFToken': csrfToken,
                },
                body: new URLSearchParams({ content: commentContent }).toString(),
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert('Error: ' + data.error);
                } else {
                    // Update the comments list dynamically
                    const commentList = document.querySelector(`#comment-list-${postId}`);
                    const newComment = document.createElement('li');
                    newComment.innerHTML = `<strong>${data.comment_author}</strong>: ${data.comment_content}`;
                    commentList.appendChild(newComment);
    
                    // Clear the textarea
                    form.querySelector('textarea[name="content"]').value = '';
                }
            })
            .catch(error => {
                console.error('Error:', error);
                form.querySelector('textarea[name="content"]').value = '';
                {% comment %} alert('Something went wrong while adding your comment.'); {% endcomment %}
            });
        });
    });
    
    
      </script>
      
        
        
</body>
</html>
