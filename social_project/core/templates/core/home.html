{% extends 'core/base.html' %}

{% block title %}Home{% endblock %}

{% block content %}
<section>
    <header>
        <h1>Welcome, {{ user.username }}!</h1>
        <p><a href="{% url 'profile' user.id %}">Go to My Profile</a></p>
    </header>

    <h2>Friend Feed</h2>
    {% if posts %}
    <ul>
        {% for post in posts %}
        <li>
            <article>
                <header>
                    <h3>
                        <a href="{% url 'profile' post.author.id %}">{{ post.author.username }}</a>
                        <p><a href="{% url 'post_detail' post.id %}">View Post</a></p> <!-- Link to post detail -->
                    </h3>
                    <p><small>Posted on {{ post.created_at|date:"F j, Y, g:i a" }}</small></p>
                </header>
                <p>{{ post.content }}</p>
                <footer>
                    <p id="like-count-{{ post.id }}">{{ post.likes.count }} likes</p>
                    <button class="like-button" data-post-id="{{ post.id }}" data-like-url="{% url 'like_post' post.id %}">
                        {% if user in post.likes.all %}
                        Unlike
                        {% else %}
                        Like
                        {% endif %}
                    </button>
                </footer>
                <!-- Comment Form -->
                <form method="post" action="{% url 'add_comment' post.id %}">
                    {% csrf_token %}
                    <textarea name="content" rows="2" placeholder="Write a comment..." required></textarea>
                    <button type="submit">Comment</button>
                </form>
            </article>
        </li>
        {% endfor %}
    </ul>
    {% else %}
    <p>No posts to display. Start adding friends or create your own post!</p>
    {% endif %}
</section>
{% endblock %}
